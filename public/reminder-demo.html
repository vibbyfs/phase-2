<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reminder Management - Demo</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .reminder-item { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .reminder-item.recurring { border-left: 4px solid #4CAF50; }
        .reminder-item.one-time { border-left: 4px solid #2196F3; }
        button { background: #f44336; color: white; border: none; padding: 8px 16px; margin: 5px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #d32f2f; }
        button.primary { background: #2196F3; }
        button.primary:hover { background: #1976D2; }
        .actions { margin: 20px 0; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        input[type="checkbox"] { margin-right: 10px; }
        .bulk-actions { background: #f5f5f5; padding: 15px; border-radius: 8px; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>üîî Reminder Management</h1>
    
    <div class="actions">
        <button class="primary" onclick="loadReminders()">üìã Load Active Reminders</button>
        <button onclick="cancelAllRecurring()">üîÑ Cancel All Recurring</button>
        <button onclick="cancelAllReminders()">‚ùå Cancel ALL Reminders</button>
    </div>

    <div class="bulk-actions">
        <h3>Bulk Actions</h3>
        <input type="text" id="keywordInput" placeholder="Enter keyword..." style="padding: 8px; margin-right: 10px;">
        <button onclick="cancelByKeyword()">Cancel by Keyword</button>
        <br><br>
        <button onclick="cancelSelected()">Cancel Selected Reminders</button>
        <button onclick="selectAll()">Select All</button>
        <button onclick="deselectAll()">Deselect All</button>
    </div>

    <div id="status"></div>
    <div id="reminders"></div>

    <script>
        const API_BASE = '/api/reminders';
        let reminders = [];

        // Demo auth token (in real app, get from login)
        const AUTH_TOKEN = 'your-jwt-token-here';

        async function apiCall(endpoint, options = {}) {
            try {
                const response = await fetch(API_BASE + endpoint, {
                    headers: {
                        'Authorization': `Bearer ${AUTH_TOKEN}`,
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                return await response.json();
            } catch (error) {
                showStatus(`Error: ${error.message}`, 'error');
                throw error;
            }
        }

        function showStatus(message, type = 'success') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="${type}">${message}</div>`;
            setTimeout(() => statusDiv.innerHTML = '', 5000);
        }

        async function loadReminders() {
            try {
                const data = await apiCall('/active');
                reminders = data.reminders;
                displayReminders();
                showStatus(`Loaded ${data.count} active reminders`);
            } catch (error) {
                console.error('Failed to load reminders:', error);
            }
        }

        function displayReminders() {
            const container = document.getElementById('reminders');
            
            if (reminders.length === 0) {
                container.innerHTML = '<p>No active reminders found.</p>';
                return;
            }

            const html = reminders.map(reminder => {
                const dueDate = new Date(reminder.dueAt).toLocaleString('id-ID');
                const repeatText = reminder.repeat !== 'none' ? 
                    (reminder.repeat === 'custom' ? 
                        ` (every ${reminder.repeatInterval} ${reminder.repeatUnit})` : 
                        ` (${reminder.repeat})`) : '';
                const isRecurring = reminder.repeat !== 'none';
                
                return `
                    <div class="reminder-item ${isRecurring ? 'recurring' : 'one-time'}">
                        <input type="checkbox" id="reminder-${reminder.id}" value="${reminder.id}">
                        <label for="reminder-${reminder.id}">
                            <strong>${reminder.title}</strong><br>
                            üìÖ ${dueDate}${repeatText}<br>
                            <small>ID: ${reminder.id} | Type: ${isRecurring ? 'Recurring' : 'One-time'}</small>
                        </label>
                        <br>
                        <button onclick="cancelReminder(${reminder.id})">Cancel This</button>
                    </div>
                `;
            }).join('');

            container.innerHTML = html;
        }

        async function cancelReminder(id) {
            if (!confirm(`Cancel reminder with ID ${id}?`)) return;
            
            try {
                await apiCall(`/${id}`, { method: 'DELETE' });
                showStatus(`Reminder ${id} cancelled successfully`);
                loadReminders(); // Reload list
            } catch (error) {
                console.error('Failed to cancel reminder:', error);
            }
        }

        async function cancelAllRecurring() {
            if (!confirm('Cancel ALL recurring reminders?')) return;
            
            try {
                const result = await apiCall('/recurring/cancel', { method: 'DELETE' });
                showStatus(result.message);
                loadReminders(); // Reload list
            } catch (error) {
                console.error('Failed to cancel recurring reminders:', error);
            }
        }

        async function cancelAllReminders() {
            if (!confirm('Cancel ALL reminders? This cannot be undone!')) return;
            
            try {
                const result = await apiCall('/all/cancel', { method: 'DELETE' });
                showStatus(result.message);
                loadReminders(); // Reload list
            } catch (error) {
                console.error('Failed to cancel all reminders:', error);
            }
        }

        async function cancelByKeyword() {
            const keyword = document.getElementById('keywordInput').value.trim();
            if (!keyword) {
                alert('Please enter a keyword');
                return;
            }
            
            if (!confirm(`Cancel all reminders containing "${keyword}"?`)) return;
            
            try {
                const result = await apiCall('/cancel-by-keyword', {
                    method: 'POST',
                    body: JSON.stringify({ keyword })
                });
                showStatus(result.message);
                loadReminders(); // Reload list
            } catch (error) {
                console.error('Failed to cancel by keyword:', error);
            }
        }

        async function cancelSelected() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            const reminderIds = Array.from(checkboxes).map(cb => parseInt(cb.value));
            
            if (reminderIds.length === 0) {
                alert('Please select at least one reminder');
                return;
            }
            
            if (!confirm(`Cancel ${reminderIds.length} selected reminders?`)) return;
            
            try {
                const result = await apiCall('/cancel-by-ids', {
                    method: 'POST',
                    body: JSON.stringify({ reminderIds })
                });
                showStatus(result.message);
                loadReminders(); // Reload list
            } catch (error) {
                console.error('Failed to cancel selected reminders:', error);
            }
        }

        function selectAll() {
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = true);
        }

        function deselectAll() {
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
        }

        // Load reminders on page load
        window.onload = () => {
            loadReminders();
        };
    </script>
</body>
</html>
